<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#020406">
    <title>Neon Elite | VIP Gaming Terminal</title>
    
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg: #020406;
            --card: rgba(10, 15, 25, 0.95);
            --glass: rgba(255, 255, 255, 0.05);
            --gold: #f59e0b;
            --gold-glow: rgba(245, 158, 11, 0.4);
            --emerald: #10b981;
            --ruby: #ef4444;
            --text: #f8fafc;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            --neon-cyan: #00f3ff;
            --neon-pink: #ff003c;
            --neon-purple: #b026ff;
            --wa-green: #25D366;
        }

        [data-theme="light"] {
            --bg: #f1f5f9;
            --card: #ffffff;
            --glass: #e2e8f0;
            --text: #0f172a;
            --text-muted: #64748b;
            --border: #cbd5e1;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); 
            color: var(--text); 
            overflow: hidden; 
            height: 100vh; 
            height: 100dvh; 
            width: 100vw; 
            transition: background 0.3s, color 0.3s; 
        }

        main { 
            flex: 1; 
            overflow-y: auto; 
            overflow-x: hidden;
            padding: 15px; 
            padding-bottom: 120px; 
            position: relative; 
            -webkit-overflow-scrolling: touch; 
        }
        main::-webkit-scrollbar { display: none; }

        #app-interface { height: 100%; display: flex; flex-direction: column; }

        /* --- Full Screen Game Mode --- */
        body.game-mode header, body.game-mode nav { display: none !important; }
        body.game-mode main { padding: 0 !important; height: 100%; overflow-y: hidden; }
        body.game-mode .game-view-container { 
            height: 100%; 
            width: 100%;
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            padding: 15px;
            background: var(--bg);
            position: relative;
        }

        /* --- Components --- */
        #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 5000; width: 90%; max-width: 350px; pointer-events: none; }
        .toast { background: var(--card); backdrop-filter: blur(15px); border: 1px solid var(--border); padding: 15px 20px; border-radius: 16px; display: flex; align-items: center; gap: 12px; margin-bottom: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); opacity: 0; transform: translateY(-20px); font-size: 13px; color: var(--text); }
        .toast.success { border-left: 4px solid var(--emerald); }
        .toast.error { border-left: 4px solid var(--ruby); }

        #loading-screen, #banned-screen { position: fixed; inset: 0; background: var(--bg); z-index: 4000; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 30px; }
        #banned-screen { display: none; background: radial-gradient(circle, #300, #020406); }
        .logo-glow { width: 80px; height: 80px; filter: drop-shadow(0 0 15px var(--gold)); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.6; } }

        #auth-screen { height: 100vh; display: none; flex-direction: column; overflow-y: auto; padding-top: 50px; }
        .modern-card { background: var(--card); backdrop-filter: blur(30px); border: 1px solid var(--border); border-radius: 30px; padding: 25px; width: 95%; max-width: 400px; margin: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.1); transition: background 0.3s; margin-bottom: 20px; }

        .field { position: relative; margin-bottom: 12px; }
        .field i { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--gold); width: 16px; }
        input, select { width: 100%; background: var(--glass); border: 1px solid var(--border); padding: 12px 12px 12px 45px; border-radius: 14px; color: var(--text); outline: none; font-size: 14px; }
        input:focus { border-color: var(--gold); box-shadow: 0 0 10px var(--gold-glow); }

        .checkbox-container { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 15px; }
        .checkbox-container input { width: 20px; height: 20px; accent-color: var(--gold); background: transparent; padding: 0; margin-top: 2px; }
        .checkbox-container label { font-size: 11px; color: var(--text-muted); line-height: 1.4; }
        .checkbox-container a { color: var(--gold); text-decoration: none; font-weight: bold; }

        .btn { width: 100%; padding: 16px; border-radius: 16px; border: none; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; text-transform: uppercase; font-size: 12px; letter-spacing: 1px; transition: 0.2s; }
        .btn-primary { background: linear-gradient(135deg, var(--emerald), #065f46); color: white; }
        .btn-gold { background: var(--gold); color: black; box-shadow: 0 0 15px var(--gold-glow); }
        .btn-wa { background: var(--wa-green); color: white; box-shadow: 0 0 15px rgba(37, 211, 102, 0.4); }
        .btn-crash { background: linear-gradient(135deg, var(--neon-pink), #990024); color: white; box-shadow: 0 0 15px rgba(255, 0, 60, 0.4); }
        .btn-slots { background: linear-gradient(135deg, var(--neon-purple), #5500aa); color: white; box-shadow: 0 0 15px rgba(176, 38, 255, 0.4); }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: var(--card); border-bottom: 1px solid var(--border); transition: background 0.3s; flex-shrink: 0; }
        .bal-pill { display: flex; align-items: center; gap: 8px; background: rgba(245,158,11,0.1); border: 1px solid var(--gold); padding: 8px 16px; border-radius: 50px; color: var(--gold); font-weight: 900; }
        
        /* --- NAVIGATION --- */
        nav { position: fixed; bottom: 0; width: 100%; height: 85px; background: var(--card); display: flex; justify-content: space-between; align-items: flex-end; border-top: 1px solid var(--border); padding: 0 5px 10px 5px; z-index: 100; transition: background 0.3s; }
        .nav-item { color: var(--text-muted); display: flex; flex-direction: column; align-items: center; font-size: 9px; gap: 5px; cursor: pointer; transition: 0.3s; width: 14%; margin-bottom: 8px; text-align: center; }
        .nav-item i { width: 18px; height: 18px; }
        .nav-item.active { color: var(--gold); transform: translateY(-3px); }
        
        .nav-center { position: relative; bottom: 15px; }
        .nav-home-btn { width: 55px; height: 55px; background: var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px var(--gold-glow); border: 4px solid var(--bg); transition: 0.2s; color: #000; }
        .nav-home-btn i { width: 24px; height: 24px; color: #000; fill: #000; }
        .nav-center.active .nav-home-btn { transform: scale(1.1); box-shadow: 0 0 30px var(--gold-glow); }

        .view { display: none; width: 100%; }
        .view.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* --- CAROUSEL --- */
        .carousel-container { width: 100%; height: 200px; overflow: hidden; margin-bottom: 25px; border-radius: 20px; border: 1px solid var(--border); background: var(--card); position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .carousel-track { display: flex; transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1); width: 100%; height: 100%; }
        .carousel-slide { min-width: 100%; height: 100%; position: relative; }
        .carousel-slide img { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.7); }
        .carousel-content { position: absolute; bottom: 20px; left: 20px; z-index: 2; }
        .proof-badge { background: var(--gold); color: black; padding: 5px 12px; border-radius: 8px; font-size: 11px; font-weight: 900; display: inline-block; margin-bottom: 5px; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4); }
        .proof-text { color: #fff; font-size: 18px; font-weight: 800; text-shadow: 0 2px 10px rgba(0,0,0,0.9); }

        /* --- CATEGORIES & GRID --- */
        .cat-title { font-size: 11px; margin-bottom: 10px; font-weight: 900; color: var(--gold); opacity: 0.8; letter-spacing: 2px; margin-top: 15px; border-left: 3px solid var(--gold); padding-left: 10px; }
        .games-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding-bottom: 10px; }
        .g-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; position: relative; transition: transform 0.1s; cursor: pointer; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .g-card:active { transform: scale(0.97); }
        .g-icon { height: 110px; display: flex; align-items: center; justify-content: center; font-size: 50px; position: relative; }
        .g-info { padding: 12px; }
        .g-title { font-size: 14px; font-weight: 900; color: var(--text); margin-bottom: 8px; letter-spacing: 0.5px; }
        .g-footer { display: flex; justify-content: space-between; align-items: center; }
        .play-tag { background: var(--text); color: var(--bg); padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: 900; display: flex; align-items: center; gap: 3px; }
        .live-users { font-size: 10px; color: var(--text-muted); display: flex; align-items: center; gap: 4px; font-weight: 600; }
        .live-dot { width: 6px; height: 6px; background: var(--emerald); border-radius: 50%; box-shadow: 0 0 5px var(--emerald); }

        /* --- Sidebar --- */
        .sidebar { position: fixed; top: 0; left: -260px; width: 260px; height: 100vh; background: var(--card); border-right: 1px solid var(--border); z-index: 6000; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); padding: 25px; display: flex; flex-direction: column; gap: 20px; box-shadow: 5px 0 30px rgba(0,0,0,0.5); }
        .sidebar.open { left: 0; }
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); z-index: 5999; display: none; opacity: 0; transition: 0.3s; }
        .sidebar-overlay.active { display: block; opacity: 1; }

        /* --- In-Game Navigation Elements --- */
        .game-menu-btn { position: absolute; top: 20px; left: 20px; width: 45px; height: 45px; background: rgba(20, 20, 30, 0.8); backdrop-filter: blur(12px); border: 1px solid var(--border); border-radius: 14px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 500; transition: 0.3s; color: var(--text); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .game-menu-btn:hover { transform: scale(1.05); }
        .game-balance-pill { position: absolute; top: 20px; right: 20px; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); border: 1px solid var(--gold); padding: 8px 16px; border-radius: 30px; color: var(--gold); font-weight: 900; font-size: 13px; z-index: 500; display: flex; align-items: center; gap: 6px; box-shadow: 0 5px 20px rgba(0,0,0,0.4); }

        /* --- Toggle Switch --- */
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--glass); border: 1px solid var(--border); transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 3px; background-color: var(--text); transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--gold); }
        input:checked + .slider:before { transform: translateX(24px); background-color: #000; }

        /* --- MINES GRID --- */
        .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin: 10px auto; width: 100%; max-width: 320px; aspect-ratio: 1/1; }
        .tile { width: 100%; height: 100%; background: var(--glass); border-radius: 8px; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; transition: 0.2s; }
        
        /* --- TOWER GRID --- */
        .tower-wrap { width: 100%; max-width: 300px; height: 400px; margin: 0 auto; display: flex; flex-direction: column-reverse; gap: 6px; position: relative; }
        .t-row { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .t-row.locked { opacity: 0.1; pointer-events: none; }
        .brick { background: var(--glass); border: 1px solid var(--border); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        #ball { position: absolute; width: 12px; height: 12px; background: white; border-radius: 50%; bottom: -12px; left: 50%; transform: translateX(-50%); box-shadow: 0 0 10px #fff; z-index: 10; }

        /* --- REAL SLOT MACHINE UI --- */
        .slot-container {
            width: 100%;
            max-width: 340px;
            margin: 0 auto 20px auto;
            background: #111;
            border: 4px solid var(--neon-purple);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 0 30px rgba(176, 38, 255, 0.3);
            position: relative;
        }
        .slot-window {
            display: flex;
            gap: 5px;
            background: #000;
            padding: 10px;
            border-radius: 10px;
            overflow: hidden;
            height: 360px; /* 3 rows visible */
            position: relative;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.9);
        }
        /* Glass reflection overlay */
        .slot-window::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.8) 100%);
            pointer-events: none;
            z-index: 5;
        }
        .reel-col {
            flex: 1;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.05);
            overflow: hidden;
            position: relative;
        }
        .reel-strip {
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        .reel-symbol {
            height: 120px; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 55px;
            width: 100%;
        }
        .reel-blur {
            filter: blur(4px);
            transition: transform 2s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .slot-line {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255, 0, 0, 0.6);
            pointer-events: none;
            z-index: 10;
            box-shadow: 0 0 10px red;
            margin-top: -2px;
        }

        /* --- SPIN WHEEL UI --- */
        .wheel-container { position: relative; width: 320px; height: 320px; margin: 40px auto; }
        .wheel-outer { width: 100%; height: 100%; border-radius: 50%; border: 5px solid var(--gold); box-shadow: 0 0 30px var(--gold-glow), inset 0 0 20px rgba(0,0,0,0.8); overflow: hidden; position: relative; transition: transform 4s cubic-bezier(0.1, 0.9, 0.2, 1); }
        .wheel-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: radial-gradient(circle, #fff, var(--gold)); border-radius: 50%; border: 4px solid #000; z-index: 5; box-shadow: 0 0 10px rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; }
        .wheel-center::after { content: "‚òÖ"; font-size: 20px; color: #000; }
        .wheel-pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 40px solid var(--neon-pink); z-index: 10; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.8)); }
        .wheel-bg { width: 100%; height: 100%; background: conic-gradient(#10b981 0deg 45deg, #ef4444 45deg 90deg, #10b981 90deg 135deg, #ef4444 135deg 180deg, #10b981 180deg 225deg, #ef4444 225deg 270deg, #f59e0b 270deg 315deg, #1e293b 315deg 360deg); border-radius: 50%; }
        .wheel-text { position: absolute; top: 0; left: 50%; width: 2px; height: 50%; transform-origin: bottom; display: flex; justify-content: center; padding-top: 15px; pointer-events: none; }
        .w-label { color: white; font-weight: 900; font-size: 16px; transform: translateX(-50%); text-shadow: 0 2px 4px black; writing-mode: vertical-rl; text-orientation: mixed; }

        /* --- CRASH UI --- */
        #crash-stage { position: relative; width: 100%; height: 320px; background: #050505; border-radius: 20px; border: 1px solid var(--border); overflow: hidden; margin-bottom: 15px; box-shadow: inset 0 0 50px rgba(0,0,0,0.8); }
        #crash-canvas { width: 100%; height: 100%; display: block; }
        .crash-history-bar { width: 100%; height: 35px; display: flex; gap: 6px; overflow-x: auto; -webkit-overflow-scrolling: touch; margin-top: 10px; margin-bottom: 10px; padding: 0 5px; }
        .crash-history-bar::-webkit-scrollbar { display: none; }
        .h-badge { background: rgba(255,255,255,0.05); color: #fff; padding: 6px 10px; border-radius: 6px; font-size: 11px; font-weight: 800; white-space: nowrap; min-width: 45px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .h-badge.win { color: var(--emerald); border-color: var(--emerald); background: rgba(16, 185, 129, 0.1); }
        .h-badge.lose { color: var(--ruby); border-color: var(--ruby); background: rgba(239, 68, 68, 0.1); }
        .h-badge.jackpot { color: var(--gold); border-color: var(--gold); background: rgba(245, 158, 11, 0.1); }
        .crash-overlay { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: none; z-index: 10; }
        .crash-mult-display { font-family: 'Courier New', monospace; font-size: 48px; font-weight: 900; color: #fff; text-shadow: 0 0 20px rgba(255,255,255,0.5); }
        .crash-status { font-size: 12px; letter-spacing: 2px; margin-bottom: 10px; color: var(--gold); text-transform: uppercase; }
        .loader-bar { width: 200px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; margin-top: 10px; }
        .loader-fill { height: 100%; background: var(--gold); width: 0%; }

        /* --- PLINKO UI --- */
        #plinko-stage { position: relative; width: 100%; height: 400px; background: #050505; border-radius: 20px; border: 1px solid var(--border); overflow: hidden; margin-bottom: 15px; box-shadow: inset 0 0 50px rgba(0,0,0,0.8); }
        #plinko-canvas { width: 100%; height: 100%; display: block; }
        .plinko-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 40px; display: flex; align-items: flex-end; justify-content: space-around; padding-bottom: 5px; pointer-events: none; }
        .p-bucket { width: 7%; text-align: center; font-size: 9px; font-weight: 900; padding: 2px 0; border-radius: 4px; color: #000; z-index: 10; }
        
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.96); backdrop-filter: blur(20px); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 15px; }
        .boss-card { background: linear-gradient(135deg, rgba(245,158,11,0.1), transparent); border: 1px solid var(--gold); border-radius: 20px; padding: 20px; text-align: center; margin-bottom: 20px; box-shadow: 0 0 15px var(--gold-glow); }
        .linked-card { background: rgba(16, 185, 129, 0.1); border: 1px solid var(--emerald); padding: 15px; border-radius: 15px; text-align: left; margin-bottom: 20px; }
        .linked-card label { font-size: 10px; color: var(--emerald); font-weight: 800; display: block; margin-bottom: 5px; letter-spacing: 1px; }
        .linked-card p { font-size: 14px; color: #fff; font-weight: 600; margin-bottom: 5px; }
    </style>
</head>
<body>

    <div id="toast-container"></div>
    
    <!-- SIDEBAR DRAWER -->
    <div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleSidebar(false)"></div>
    <div id="game-sidebar" class="sidebar">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3 style="color:var(--text); font-weight:900;">GAME MENU</h3>
            <i data-lucide="x" onclick="toggleSidebar(false)" style="cursor:pointer; color:var(--text-muted);"></i>
        </div>
        <div style="flex:1; display: flex; flex-direction: column; gap: 10px;">
            <p style="font-size:11px; opacity:0.5; margin-bottom:10px;">OPTIONS</p>
            <button class="btn btn-outline" onclick="location.reload()" style="border-color:var(--text); color:var(--text);">
                <i data-lucide="refresh-cw"></i> REFRESH GAME
            </button>
            <button class="btn btn-outline" onclick="goHome()" style="border-color:var(--gold); color:var(--gold);">
                <i data-lucide="home"></i> EXIT TO LOBBY
            </button>
        </div>
        <p style="font-size:10px; text-align:center; opacity:0.3;">NEON ELITE SYSTEM</p>
    </div>

    <!-- AUDIO ASSETS -->
    <audio id="bg-music" src="bg_music.mp3" loop></audio>
    <audio id="sfx-fly" src="fly_away.mp3"></audio>

    <!-- System Screens -->
    <section id="loading-screen">
        <svg class="logo-glow" viewBox="0 0 100 100"><polygon points="50,5 95,25 95,75 50,95 5,75 5,25" fill="none" stroke="#f59e0b" stroke-width="3"/><path d="M30 40 L50 20 L70 40 L50 80 Z" fill="#f59e0b"/></svg>
        <h2 style="color: var(--gold); letter-spacing: 5px; margin-top: 20px; font-weight: 900;">NEON ELITE</h2>
    </section>

    <section id="banned-screen">
        <i data-lucide="shield-off" style="width:60px; height:60px; color: var(--ruby); margin-bottom: 20px;"></i>
        <h2 style="color: var(--ruby); margin-bottom: 10px; font-weight: 900;">ACCESS TERMINATED</h2>
        <p style="opacity: 0.7; font-size: 13px; max-width: 300px;">Your account has been permanently removed by the administrator.</p>
        <button class="btn btn-outline" style="margin-top: 30px; border-color: var(--ruby); color: var(--ruby);" onclick="location.reload()">Refresh System</button>
    </section>

    <!-- Approval Modal -->
    <div id="approval-modal" class="modal">
        <div class="modern-card" style="text-align:center; border-color:var(--emerald);">
            <div style="background:rgba(16,185,129,0.1); width:70px; height:70px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 20px;">
                <i data-lucide="check-circle" style="width:40px; height:40px; color:var(--emerald);"></i>
            </div>
            <h2 style="color:var(--emerald); font-weight:900; margin-bottom:10px;">APPROVED!</h2>
            <p style="font-size:13px; margin-bottom:20px;">Transaction approved by Admin.</p>
            <h1 id="approved-amount" style="color:var(--text); font-size:32px; font-weight:900;">Rs. 0</h1>
            <button class="btn btn-primary" style="margin-top:20px;" onclick="document.getElementById('approval-modal').style.display='none'">OK</button>
        </div>
    </div>

    <!-- Support Popup Modal -->
    <div id="support-modal" class="modal">
        <div class="modern-card" style="text-align:center; border-color:var(--wa-green); position: relative;">
            <i data-lucide="x" onclick="closeSupport()" style="position: absolute; top: 15px; right: 15px; cursor:pointer; opacity: 0.5;"></i>
            <div style="background:rgba(37, 211, 102, 0.1); width:70px; height:70px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 20px;">
                <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" style="width:40px; height:40px;">
            </div>
            <h2 style="color:var(--wa-green); font-weight:900; margin-bottom:10px;">JOIN SUPPORT</h2>
            <p style="font-size:13px; margin-bottom:25px; line-height: 1.6;">Join this WhatsApp group to stay updated with every news.</p>
            <button class="btn btn-wa" onclick="window.open('https://chat.whatsapp.com/KEfbuGkkFQF2bz1Hx7Bp9K', '_blank')"><i data-lucide="message-circle"></i> JOIN NOW</button>
        </div>
    </div>

    <!-- 1. SETUP PASSCODE MODAL -->
    <div id="setup-passcode-modal" class="modal">
        <div class="modern-card">
            <h3 style="color:var(--gold); text-align:center; margin-bottom:15px; font-weight:900;">SETUP WALLET PIN</h3>
            <p style="font-size:12px; opacity:0.7; text-align:center; margin-bottom:20px;">Create a secure 8-digit PIN. This cannot be changed later.</p>
            <div class="field"><i data-lucide="lock"></i><input type="number" id="new-passcode" placeholder="Enter 8-digit PIN"></div>
            <button class="btn btn-gold" onclick="savePasscode()">SAVE PIN</button>
        </div>
    </div>

    <!-- 2. BIND ACCOUNT MODAL -->
    <div id="bind-account-modal" class="modal">
        <div class="modern-card">
            <h3 style="color:var(--emerald); text-align:center; margin-bottom:15px; font-weight:900;">BIND ACCOUNT</h3>
            <p style="font-size:11px; color:var(--text-muted); text-align:center; margin-bottom:20px;">Provide REAL details. These will be used for all future withdrawals and cannot be changed.</p>
            
            <div class="field">
                <i data-lucide="building"></i>
                <select id="bind-bank" style="padding-left: 45px;" onchange="toggleBindBankInput()">
                    <option value="EasyPaisa">EasyPaisa</option>
                    <option value="JazzCash">JazzCash</option>
                    <option value="Other">Other Bank</option>
                </select>
            </div>
            <div class="field" id="bind-other-bank-div" style="display: none;">
                <i data-lucide="pen-tool"></i><input type="text" id="bind-other-bank" placeholder="Enter Bank Name">
            </div>
            <div class="field"><i data-lucide="user"></i><input type="text" id="bind-name" placeholder="Account Holder Name"></div>
            <div class="field"><i data-lucide="hash"></i><input type="text" id="bind-number" placeholder="Account Number"></div>
            <div class="field"><i data-lucide="credit-card"></i><input type="text" id="bind-cnic" placeholder="CNIC Number"></div>

            <button class="btn btn-primary" onclick="bindAccount()"><i data-lucide="link"></i> BIND & CLAIM BONUS</button>
        </div>
    </div>

    <!-- Txn Modal -->
    <div id="txn-modal" class="modal">
        <div class="modern-card" style="width: 100%;">
            <div style="display:flex; justify-content: space-between; margin-bottom:20px;">
                <h3 id="modal-title" style="font-size: 16px; font-weight: 900; color:var(--text);">REQUEST</h3>
                <i data-lucide="x-circle" onclick="closeModal()" style="cursor:pointer; opacity: 0.5; color:var(--text);"></i>
            </div>

            <!-- DEPOSIT VIEW -->
            <div id="deposit-view">
                <div class="boss-card">
                    <p style="font-size: 10px; color: var(--gold); letter-spacing: 2px;">OFFICIAL RECEIVER</p>
                    <h2 style="color: #fff; margin: 5px 0;">+923284378937</h2>
                    <p style="font-size: 14px; font-weight: 800;">Name: UMEED UMEED</p>
                </div>
                <div class="field"><i data-lucide="hash"></i><input type="number" id="txn-amount" placeholder="Amount (PKR)"></div>
                <div class="field"><i data-lucide="user"></i><input type="text" id="txn-name" placeholder="Sender Name"></div>
                <div class="field">
                    <i data-lucide="building"></i>
                    <select id="txn-bank" style="padding-left: 45px;" onchange="toggleBankInput()">
                        <option value="EasyPaisa">EasyPaisa</option><option value="JazzCash">JazzCash</option><option value="Other">Other Bank</option>
                    </select>
                </div>
                <div class="field" id="other-bank-div" style="display: none;"><i data-lucide="pen-tool"></i><input type="text" id="txn-other-bank" placeholder="Enter Bank Name"></div>
                <div class="field"><i data-lucide="phone"></i><input type="text" id="txn-number" placeholder="Sender Mobile / TID"></div>
                <button class="btn btn-gold" onclick="submitDeposit()"><i data-lucide="send"></i> Submit Deposit</button>
            </div>

            <!-- WITHDRAW VIEW -->
            <div id="withdraw-view" style="display:none;">
                <div id="linked-account-card" class="linked-card">
                    <label>LINKED ACCOUNT</label>
                    <p id="wd-bank">Bank: Loading...</p>
                    <p id="wd-number">Account: Loading...</p>
                    <p id="wd-name">Name: Loading...</p>
                </div>
                <div class="field"><i data-lucide="hash"></i><input type="number" id="wd-amount" placeholder="Withdraw Amount"></div>
                <div class="field"><i data-lucide="lock"></i><input type="number" id="wd-passcode" placeholder="8-Digit Wallet PIN"></div>
                <button class="btn btn-gold" onclick="submitWithdraw()"><i data-lucide="arrow-down-to-line"></i> Request Withdraw</button>
            </div>
        </div>
    </div>

    <!-- Auth -->
    <section id="auth-screen">
        <div class="modern-card">
            <h2 id="auth-title" style="text-align:center; margin-bottom:25px; letter-spacing: 3px; font-weight: 900; color: var(--gold);">CREATE ACCOUNT</h2>
            <div class="field"><i data-lucide="mail"></i><input type="email" id="auth-email" placeholder="Gmail Only"></div>
            <div class="field"><i data-lucide="lock"></i><input type="password" id="auth-pass" placeholder="Password"></div>
            
            <div id="signup-extra">
                <div class="field"><i data-lucide="message-circle"></i><input type="text" id="auth-wa" placeholder="WhatsApp (e.g. +923001234567)"></div>
                <div class="field"><i data-lucide="users"></i><input type="text" id="auth-referral" placeholder="Referral Code (Optional)"></div>
                <div class="checkbox-container">
                    <input type="checkbox" id="auth-terms">
                    <label for="auth-terms">I agree to the <a href="https://neon-terms-conditions-app.vercel.app" target="_blank">Terms & Conditions</a></label>
                </div>
            </div>

            <div id="signup-btns">
                <button class="btn btn-gold" onclick="handleAuth('signup')"><i data-lucide="check-circle"></i> Complete Signup</button>
                <button class="btn btn-outline" style="margin-top:10px;" onclick="toggleAuthMode('login')">Already have an account? Login</button>
            </div>

            <div id="auth-btns" style="display: none;">
                <button class="btn btn-primary" onclick="handleAuth('login')"><i data-lucide="log-in"></i> Secure Sign In</button>
                <button class="btn btn-outline" style="margin-top:10px;" onclick="toggleAuthMode('signup')">Create New Account</button>
            </div>
            <p id="auth-error" style="color:var(--ruby); font-size:10px; margin-top:15px; text-align:center;"></p>
        </div>
    </section>

    <!-- App Main Interface -->
    <div id="app-interface">
        <header>
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="display:flex; align-items:center; gap:8px;">
                    <i data-lucide="crown" style="color:var(--gold); width:18px;"></i>
                    <span style="font-weight:900; font-size:13px; letter-spacing:1px; color:var(--text);">NEON ELITE</span>
                </div>
            </div>
            <div class="bal-pill">
                <i data-lucide="wallet" style="width:16px;"></i>
                Rs. <span id="header-bal">0.00</span>
                <i data-lucide="refresh-cw" id="ref-btn" style="width:14px; cursor:pointer;" onclick="refreshBal()"></i>
            </div>
        </header>

        <main>
            <!-- DASHBOARD -->
            <div id="view-home" class="view active"></div>

            <!-- OFFERS VIEW -->
            <div id="view-offers" class="view">
                <div class="modern-card" style="text-align:center; background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(0,0,0,0.4)); border-color: var(--gold);">
                    <div style="background:var(--gold); width:60px; height:60px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 15px; box-shadow: 0 0 20px var(--gold-glow);">
                        <i data-lucide="gift" style="width:30px; height:30px; color:#000;"></i>
                    </div>
                    <h2 style="color:var(--gold); font-weight:900; margin-bottom:5px;">SIGNUP BONUS</h2>
                    <h1 style="color:#fff; font-size:36px; font-weight:900; margin:10px 0;">Rs. 177.00</h1>
                    <p style="font-size:12px; opacity:0.8; margin-bottom:20px;">Bind your Real Account (EasyPaisa/JazzCash) to claim this bonus instantly! No WhatsApp required.</p>
                    <button class="btn btn-gold" onclick="handleClaimBonus()">CLAIM NOW</button>
                </div>
            </div>

            <!-- REFERRAL VIEW -->
            <div id="view-refer" class="view">
                <div class="modern-card" style="text-align:center; margin-bottom:20px;">
                    <i data-lucide="gift" style="width:40px; height:40px; color:var(--gold); margin-bottom:10px;"></i>
                    <h2 style="color:var(--text); margin-bottom:5px;">REFER TO EARN</h2>
                    <p style="font-size:11px; color:var(--text-muted);">Get +1 Spin for every friend who joins.</p>
                </div>
                <div class="modern-card" style="margin-bottom:20px;">
                    <p style="font-size:10px; opacity:0.5; margin-bottom:5px;">YOUR REFERRAL LINK</p>
                    <div style="background:var(--bg); padding:15px; border-radius:12px; border:1px dashed var(--gold); display:flex; justify-content:space-between; align-items:center;">
                        <h3 id="ref-code-display" style="color:var(--gold); font-size: 11px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px;">LOADING...</h3>
                        <i data-lucide="copy" style="cursor:pointer; opacity:0.7;" onclick="copyReferral()"></i>
                    </div>
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div class="modern-card" style="padding:15px; text-align:center; width:100%;">
                        <h1 id="ref-count" style="color:var(--emerald);">0</h1>
                        <p style="font-size:9px; opacity:0.5;">TOTAL REFERRALS</p>
                    </div>
                    <div class="modern-card" style="padding:15px; text-align:center; width:100%;">
                        <h1 id="ref-earn" style="color:var(--gold);">Rs. 0</h1>
                        <p style="font-size:9px; opacity:0.5;">EARNINGS</p>
                    </div>
                </div>
            </div>

            <!-- SPIN WHEEL VIEW -->
            <div id="view-spin" class="view">
                <div class="modern-card" style="text-align:center; margin-bottom:20px;">
                    <i data-lucide="aperture" style="width:30px; height:30px; color:var(--neon-pink); animation: spin 3s linear infinite;"></i>
                    <h2 style="color:var(--text); margin:10px 0;">NEON WHEEL</h2>
                    <p style="font-size:11px; color:var(--text-muted);">2 Free Spins Daily. Refer friends for more!</p>
                    <p style="font-size:12px; margin-top:10px; color:var(--gold); font-weight:bold;">Spins Available: <span id="spins-available">0</span></p>
                </div>

                <div class="wheel-container">
                    <div class="wheel-pointer"></div>
                    <div class="wheel-outer" id="wheel-outer">
                        <div class="wheel-bg"></div>
                        <div class="wheel-center"></div>
                        <div class="wheel-text" style="transform: rotate(22.5deg);"><span class="w-label">+5</span></div>
                        <div class="wheel-text" style="transform: rotate(67.5deg);"><span class="w-label">-5</span></div>
                        <div class="wheel-text" style="transform: rotate(112.5deg);"><span class="w-label">+3</span></div>
                        <div class="wheel-text" style="transform: rotate(157.5deg);"><span class="w-label">-3</span></div>
                        <div class="wheel-text" style="transform: rotate(202.5deg);"><span class="w-label">+1</span></div>
                        <div class="wheel-text" style="transform: rotate(247.5deg);"><span class="w-label">-1</span></div>
                        <div class="wheel-text" style="transform: rotate(292.5deg);"><span class="w-label">SPIN</span></div>
                        <div class="wheel-text" style="transform: rotate(337.5deg);"><span class="w-label" style="font-size:12px;">üò≠</span></div>
                    </div>
                </div>

                <div style="text-align:center; margin-top:20px;">
                    <button id="btn-spin" class="btn btn-gold" style="width:200px; margin:0 auto;" onclick="spinWheel()">SPIN NOW</button>
                    <p id="spin-msg" style="margin-top:15px; font-size:12px; font-weight:bold;"></p>
                </div>
            </div>

            <!-- SETTINGS VIEW -->
            <div id="view-settings" class="view">
                <div class="modern-card" style="width:100%;">
                    <h3 style="margin-bottom:20px; color:var(--text);"><i data-lucide="settings" style="width:18px; display:inline; margin-right:5px;"></i> SETTINGS</h3>
                    <div style="display:flex; justify-content:space-between; align-items:center; padding:15px 0; border-bottom:1px solid var(--border);">
                        <div><h5 style="color:var(--text);">Theme</h5><p style="font-size:10px; color:var(--text-muted);">Switch light/dark mode</p></div>
                        <label class="switch"><input type="checkbox" id="theme-toggle" onchange="toggleTheme()"><span class="slider"></span></label>
                    </div>
                    <button class="btn btn-outline" style="margin-top:30px; border-color:var(--ruby); color:var(--ruby);" onclick="auth.signOut()"><i data-lucide="log-out"></i> Sign Out</button>
                </div>
            </div>

            <!-- GAME VIEWS (FULL SCREEN) -->
            <div id="view-mines" class="view">
                <div class="game-view-container">
                    <div class="game-menu-btn" onclick="toggleSidebar(true)"><i data-lucide="align-left" style="width:20px;"></i></div>
                    <div class="game-balance-pill"><i data-lucide="wallet" style="width:14px;"></i> <span class="live-balance-display">0.00</span></div>
                    <div class="modern-card" style="width:100%; margin-bottom:20px; padding:20px;">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px;">
                            <div><label style="font-size:9px; opacity:0.5;">BET</label><input type="number" id="mine-bet" value="50"></div>
                            <div><label style="font-size:9px; opacity:0.5;">MINES</label><input type="number" id="mine-count" value="3"></div>
                        </div>
                        <button class="btn btn-primary" id="btn-m-start" onclick="startMines()"><i data-lucide="play"></i> Start Mines</button>
                        <button class="btn btn-gold" id="btn-m-cash" style="display:none;" onclick="cashoutMines()"><i data-lucide="banknote"></i> Cash Out</button>
                    </div>
                    <div id="mine-status" style="text-align:center; color:var(--gold); font-weight:900; font-size:14px; margin-bottom:15px;"></div>
                    <div class="mines-grid" id="mines-grid"></div>
                </div>
            </div>

            <div id="view-bricks" class="view">
                <div class="game-view-container">
                    <div class="game-menu-btn" onclick="toggleSidebar(true)"><i data-lucide="align-left" style="width:20px;"></i></div>
                    <div class="game-balance-pill"><i data-lucide="wallet" style="width:14px;"></i> <span class="live-balance-display">0.00</span></div>
                    <div class="modern-card" style="width:100%; margin-bottom:15px; padding:15px;">
                        <label style="font-size:10px; opacity:0.5;">BET AMOUNT</label>
                        <div style="display:flex; gap:10px; align-items:flex-end;">
                            <input type="number" id="brick-bet" value="50" style="margin-bottom:0;">
                            <button class="btn btn-primary" id="btn-b-start" style="width:120px;" onclick="startBricks()"><i data-lucide="arrow-up-circle"></i> Start</button>
                            <button class="btn btn-gold" id="btn-b-cash" style="display:none; width:120px;" onclick="cashoutBricks()"><i data-lucide="dollar-sign"></i> Cashout</button>
                        </div>
                    </div>
                    <div id="brick-status" style="text-align:center; color:var(--gold); font-weight:900; font-size:12px; margin-bottom:5px;">Next: Row 1</div>
                    <div class="tower-wrap" id="tower-container"><div id="ball"></div></div>
                </div>
            </div>

            <div id="view-crash" class="view">
                <div class="game-view-container">
                    <div class="game-menu-btn" onclick="toggleSidebar(true)"><i data-lucide="align-left" style="width:20px;"></i></div>
                    <div class="game-balance-pill"><i data-lucide="wallet" style="width:14px;"></i> <span class="live-balance-display">0.00</span></div>
                    <div id="crash-stage">
                        <canvas id="crash-canvas"></canvas>
                        <div class="crash-overlay">
                            <div id="crash-msg" class="crash-status">WAITING FOR ROUND</div>
                            <div id="crash-value" class="crash-mult-display">0.00x</div>
                            <div class="loader-bar" id="crash-loader" style="display:none;"><div class="loader-fill" id="crash-fill"></div></div>
                        </div>
                    </div>
                    <div class="crash-history-bar" id="crash-history"></div>
                    <div class="modern-card" style="width:100%; padding: 15px; margin-top: 5px;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                            <label style="font-size:9px; opacity:0.5;">BET AMOUNT</label>
                            <label style="font-size:9px; opacity:0.5;">AUTO CASH (OPTIONAL)</label>
                        </div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">
                            <input type="number" id="crash-bet" value="50" placeholder="Bet">
                            <input type="number" id="crash-auto" value="2.0" placeholder="Auto x">
                        </div>
                        <button class="btn btn-crash" id="btn-crash-action" onclick="handleCrashAction()"><i data-lucide="rocket"></i> PLACE BET</button>
                    </div>
                </div>
            </div>

             <div id="view-plinko" class="view">
                <div class="game-view-container">
                    <div class="game-menu-btn" onclick="toggleSidebar(true)"><i data-lucide="align-left" style="width:20px;"></i></div>
                    <div class="game-balance-pill"><i data-lucide="wallet" style="width:14px;"></i> <span class="live-balance-display">0.00</span></div>
                    <div id="plinko-stage">
                        <canvas id="plinko-canvas"></canvas>
                        <div class="plinko-overlay" id="plinko-buckets"></div>
                    </div>
                    <div class="modern-card" style="width:100%; padding: 15px; margin-top: 20px;">
                        <label style="font-size:9px; opacity:0.5;">BET AMOUNT</label>
                        <div style="display:flex; gap:10px; align-items:center;">
                            <input type="number" id="plinko-bet" value="50" placeholder="Bet">
                            <button class="btn btn-primary" onclick="dropPlinkoBall()"><i data-lucide="arrow-down"></i> DROP</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEW: NEON SLOTS VIEW -->
            <div id="view-slots" class="view">
                <div class="game-view-container">
                    <div class="game-menu-btn" onclick="toggleSidebar(true)"><i data-lucide="align-left" style="width:20px;"></i></div>
                    <div class="game-balance-pill"><i data-lucide="wallet" style="width:14px;"></i> <span class="live-balance-display">0.00</span></div>
                    
                    <div style="text-align:center; margin-bottom:10px;">
                        <h2 style="color:var(--neon-purple); font-weight:900; letter-spacing:2px; text-shadow:0 0 10px var(--neon-purple);">NEON SLOTS</h2>
                    </div>

                    <div class="slot-container">
                        <div class="slot-window">
                            <!-- Reel 1 -->
                            <div class="reel-col">
                                <div class="reel-strip" id="strip-0"></div>
                            </div>
                            <!-- Reel 2 -->
                            <div class="reel-col">
                                <div class="reel-strip" id="strip-1"></div>
                            </div>
                            <!-- Reel 3 -->
                            <div class="reel-col">
                                <div class="reel-strip" id="strip-2"></div>
                            </div>
                            <div class="slot-line"></div>
                        </div>
                    </div>

                    <div class="modern-card" style="width:100%; padding: 15px;">
                        <label style="font-size:9px; opacity:0.5;">BET AMOUNT</label>
                        <div style="display:flex; gap:10px; align-items:center;">
                            <input type="number" id="slots-bet" value="10" placeholder="Bet">
                            <button id="btn-slots-spin" class="btn btn-slots" onclick="spinSlots()"><i data-lucide="refresh-cw"></i> SPIN</button>
                        </div>
                    </div>
                    
                    <div class="modern-card" style="width:100%; padding: 15px; margin-top: 10px; background: rgba(0,0,0,0.5);">
                         <p style="font-size:10px; opacity:0.7; text-align:center; margin-bottom:5px;">PAYOUTS (MATCH 3)</p>
                         <div style="display:flex; justify-content:space-around; font-size:11px;">
                             <span>üíé 25x</span>
                             <span>7Ô∏è‚É£ 15x</span>
                             <span>üîî 5x</span>
                             <span>üçá 2.5x</span>
                         </div>
                    </div>
                </div>
            </div>

            <div id="view-profile" class="view">
                <div class="modern-card" style="width:100%; text-align:center; margin-bottom:20px;">
                    <p style="opacity:0.5; font-size:10px;">WALLET BALANCE</p>
                    <h1 style="color:var(--emerald); margin:10px 0; font-size:36px; font-weight:900;">Rs. <span id="prof-bal">0.00</span></h1>
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px;">
                    <button class="btn btn-primary" onclick="openModal('Deposit')"><i data-lucide="plus"></i> Deposit</button>
                    <button id="withdraw-btn-main" class="btn btn-gold" style="display:none" onclick="openModal('Withdraw')"><i data-lucide="arrow-down-to-line"></i> Withdraw</button>
                </div>
                <div id="withdraw-locked" style="background:rgba(239,68,68,0.05); border:1px dashed var(--ruby); padding:20px; border-radius:20px; text-align:center;">
                    <p style="font-size:11px; color:var(--ruby); font-weight:900;"><i data-lucide="lock" style="width:14px;"></i> WITHDRAW LOCKED</p>
                    <p style="font-size:10px; opacity:0.5; margin-top:5px;">500 PKR balance required.</p>
                </div>
            </div>
        </main>

        <nav>
            <div class="nav-item" id="nav-spin" onclick="switchTab('spin')"><i data-lucide="aperture"></i><span>Spin</span></div>
            <div class="nav-item" id="nav-refer" onclick="switchTab('refer')"><i data-lucide="users"></i><span>Refer</span></div>
            <div class="nav-item" id="nav-offers" onclick="switchTab('offers')"><i data-lucide="gift"></i><span>Offers</span></div>
            <div class="nav-item nav-center active" id="nav-home" onclick="switchTab('home')"><div class="nav-home-btn"><i data-lucide="home"></i></div></div>
            <div class="nav-item" id="nav-profile" onclick="switchTab('profile')"><i data-lucide="wallet"></i><span>Wallet</span></div>
            <div class="nav-item" onclick="openSupport()"><i data-lucide="headphones"></i><span>Support</span></div>
            <div class="nav-item" id="nav-settings" onclick="switchTab('settings')"><i data-lucide="settings"></i><span>Settings</span></div>
        </nav>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA3D_1IRdpPB_2rmF5rtGqvJ1EXFNF2zxc", authDomain: "alarix-61e90.firebaseapp.com", databaseURL: "https://alarix-61e90-default-rtdb.firebaseio.com", projectId: "alarix-61e90", storageBucket: "alarix-61e90.firebasestorage.app", messagingSenderId: "747193234958", appId: "1:747193234958:web:c69501009d5950b63d6e5f", measurementId: "G-DV5XBRC8L1" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        const WHATSAPP_SUPPORT = "+923140943604";
        let userData = null;
        let audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const refParam = urlParams.get('ref') || window.location.hash.substring(1);
            if (refParam && refParam.length > 5) {
                document.getElementById('auth-referral').value = refParam;
                document.getElementById('app-interface').style.display = 'none';
                document.getElementById('auth-screen').style.display = 'flex';
                toast("Referral Code Applied!");
            }
            setInterval(updateLiveUsers, 3000);
            initSlots(); // Initialize slot strips
        };

        const proofs = [
            { txt: "DEPOSIT", img: "https://images.unsplash.com/photo-1518546305927-5a555bb7020d?auto=format&fit=crop&w=600&q=80" },
            { txt: "WITHDRAW", img: "https://images.unsplash.com/photo-1559526324-4b87b5e36e44?auto=format&fit=crop&w=600&q=80" },
            { txt: "BIG WIN", img: "https://images.unsplash.com/photo-1605901309584-818e25960b8f?auto=format&fit=crop&w=600&q=80" },
            { txt: "JACKPOT", img: "https://images.unsplash.com/photo-1518133910546-b6c2fb7d79e3?auto=format&fit=crop&w=600&q=80" },
            { txt: "VIP", img: "https://images.unsplash.com/photo-1639322537228-f710d846310a?auto=format&fit=crop&w=600&q=80" }
        ];

        function initCarousel() {
            const track = document.getElementById('dash-track');
            if(!track) return;
            track.innerHTML = '';
            proofs.forEach(p => {
                const div = document.createElement('div');
                div.className = 'carousel-slide';
                div.innerHTML = `<img src="${p.img}" onerror="this.src='https://via.placeholder.com/600x300?text=GAME+PROOF'"><div class="carousel-content"><span class="proof-badge">${p.txt}</span><div class="proof-text">SUCCESSFUL</div></div>`;
                track.appendChild(div);
            });
            let index = 0;
            setInterval(() => {
                index++;
                if (index >= proofs.length) index = 0;
                track.style.transform = `translateX(-${index * 100}%)`;
            }, 3000);
        }

        function updateLiveUsers() {
            const dots = document.querySelectorAll('.live-users');
            dots.forEach(d => {
                const text = d.innerText || "";
                if (!text.includes(' ')) return;
                const parts = text.split(' ');
                if (parts.length < 2) return;
                let valStr = parts[1];
                if (!valStr) return;
                let current = parseInt(valStr.replace('k', '')) * 1000 || 800;
                let change = Math.floor(Math.random() * 50) - 25;
                let newVal = current + change;
                if(newVal > 999) d.innerHTML = `<div class="live-dot"></div> ${(newVal/1000).toFixed(1)}k`;
                else d.innerHTML = `<div class="live-dot"></div> ${newVal}`;
            });
        }

        function toggleSidebar(show) {
            const sb = document.getElementById('game-sidebar');
            const ol = document.getElementById('sidebar-overlay');
            if(show) { sb.classList.add('open'); ol.classList.add('active'); } 
            else { sb.classList.remove('open'); ol.classList.remove('active'); }
        }

        function goHome() { toggleSidebar(false); stopGameSounds(); switchTab('home'); }
        function toggleTheme() {
            const isChecked = document.getElementById('theme-toggle').checked;
            const meta = document.querySelector('meta[name="theme-color"]');
            if(isChecked) { document.documentElement.setAttribute('data-theme', 'light'); if(meta) meta.setAttribute("content", "#f1f5f9"); } 
            else { document.documentElement.removeAttribute('data-theme'); if(meta) meta.setAttribute("content", "#020406"); }
        }

        const bgMusic = document.getElementById('bg-music');
        const sfxFly = document.getElementById('sfx-fly');
        bgMusic.volume = 0.4;

        function sfx(type) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            
            // CRASH MUSIC ONLY
            if (type === 'engine_start') { 
                bgMusic.currentTime = 0; 
                bgMusic.play().catch(()=>{}); 
            } 
            else if (type === 'engine_stop') { bgMusic.pause(); }
            else if (type === 'crash_fly') { sfxFly.currentTime = 0; sfxFly.play().catch(()=>{}); }
            
            // SLOT SPECIFIC MECHANICAL SOUND
            else if (type === 'slot_spin') {
                const osc = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(50, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 2);
                g.gain.setValueAtTime(0.05, audioCtx.currentTime);
                g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 2);
                osc.connect(g);
                g.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + 2);
            }
            // GENERAL SOUNDS
            else {
                const osc = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                osc.connect(g); g.connect(audioCtx.destination);
                g.gain.setValueAtTime(0.1, audioCtx.currentTime);
                if(type==='win'){ osc.type='sine'; osc.frequency.setValueAtTime(500,audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(1200,audioCtx.currentTime+0.3); g.gain.linearRampToValueAtTime(0,audioCtx.currentTime+0.3); }
                else if(type==='lose'){ osc.type='sawtooth'; osc.frequency.setValueAtTime(150,audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(50,audioCtx.currentTime+0.3); g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.3); }
                else if(type==='clack'){ osc.type='square'; osc.frequency.setValueAtTime(200,audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(50,audioCtx.currentTime+0.1); g.gain.setValueAtTime(0.05,audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01,audioCtx.currentTime+0.1); }
                else { osc.type='sine'; osc.frequency.setValueAtTime(400,audioCtx.currentTime); }
                osc.start(); osc.stop(audioCtx.currentTime + (type==='win'||type==='lose'?0.3:0.1));
            }
        }

        function stopGameSounds() { bgMusic.pause(); bgMusic.currentTime = 0; sfxFly.pause(); sfxFly.currentTime = 0; }
        function toast(msg, type='success') {
            const container = document.getElementById('toast-container');
            const el = document.createElement('div'); el.className = `toast ${type}`;
            el.innerHTML = `<i data-lucide="bell" style="width:18px;"></i> <span>${msg}</span>`;
            container.appendChild(el); lucide.createIcons();
            gsap.to(el, { opacity:1, y:0, duration:0.4 });
            setTimeout(() => gsap.to(el, { opacity:0, y:-20, duration:0.4, onComplete:()=>el.remove() }), 3000);
        }

        auth.onAuthStateChanged((user) => {
            if (user) {
                db.collection('users').doc(user.uid).onSnapshot((doc) => {
                    if (!doc.exists) { auth.signOut(); document.getElementById('banned-screen').style.display = 'flex'; return; }
                    userData = doc.data(); userData.uid = user.uid;
                    if(!userData.spinData) userData.spinData = { count: 0, date: "" };
                    if(!userData.extraSpins) userData.extraSpins = 0;
                    updateUI();
                    document.getElementById('auth-screen').style.display = 'none';
                    document.getElementById('app-interface').style.display = 'flex';
                    document.getElementById('loading-screen').style.display = 'none';
                    initCarousel();
                });
                db.collection('requests').where('uid', '==', user.uid).where('status', '==', 'approved').onSnapshot(snapshot => {
                    snapshot.docChanges().forEach(change => {
                        if (change.type === 'modified') {
                            const data = change.doc.data();
                            document.getElementById('approved-amount').innerText = "Rs. " + data.amount;
                            document.getElementById('approval-modal').style.display = 'flex';
                            sfx('win'); confetti();
                        }
                    });
                });
            } else {
                document.getElementById('app-interface').style.display = 'none';
                document.getElementById('auth-screen').style.display = 'flex';
                document.getElementById('loading-screen').style.display = 'none';
                toggleAuthMode('signup');
            }
        });

        async function handleAuth(type) {
            const e = document.getElementById('auth-email').value.toLowerCase().trim();
            const p = document.getElementById('auth-pass').value;
            if(!e || !p) return toast("Fill fields", "error");
            try {
                if (type === 'signup') {
                    const terms = document.getElementById('auth-terms').checked;
                    if (!terms) return toast("Agree to Terms first", "error");
                    const wa = document.getElementById('auth-wa').value.trim();
                    const refCode = document.getElementById('auth-referral').value.trim();
                    if(!e.endsWith('@gmail.com')) return toast("Gmail only", "error");
                    const cred = await auth.createUserWithEmailAndPassword(e, p);
                    await db.collection('users').doc(cred.user.uid).set({ 
                        balance: 0, email: e, whatsapp: wa, isVerified: false,
                        walletPasscode: null, paymentMethod: null, bonusClaimed: false,
                        referredBy: refCode || null, referralEarnings: 0, totalReferrals: 0,
                        spinData: { count: 0, date: new Date().toDateString() }, extraSpins: 0,
                        joinDate: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    if (refCode) {
                        const refDoc = await db.collection('users').doc(refCode).get();
                        if(refDoc.exists) await db.collection('users').doc(refCode).update({ balance: firebase.firestore.FieldValue.increment(5), referralEarnings: firebase.firestore.FieldValue.increment(5), totalReferrals: firebase.firestore.FieldValue.increment(1), extraSpins: firebase.firestore.FieldValue.increment(1) });
                    }
                } else await auth.signInWithEmailAndPassword(e, p);
            } catch (err) { toast(err.message, "error"); }
        }

        function toggleAuthMode(mode) {
            if(mode === 'login') {
                document.getElementById('signup-extra').style.display = 'none';
                document.getElementById('signup-btns').style.display = 'none';
                document.getElementById('auth-btns').style.display = 'block';
                document.getElementById('auth-title').innerText = "MEMBER LOGIN";
            } else {
                document.getElementById('signup-extra').style.display = 'block';
                document.getElementById('signup-btns').style.display = 'block';
                document.getElementById('auth-btns').style.display = 'none';
                document.getElementById('auth-title').innerText = "CREATE ACCOUNT";
            }
        }

        function updateUI() {
            if(!userData) return;
            const b = userData.balance || 0;
            const formattedBal = b.toFixed(2);
            document.getElementById('header-bal').innerText = formattedBal;
            document.getElementById('prof-bal').innerText = formattedBal;
            document.querySelectorAll('.live-balance-display').forEach(el => el.innerText = formattedBal);
            document.getElementById('withdraw-btn-main').style.display = (b >= 500) ? 'flex' : 'none';
            document.getElementById('withdraw-locked').style.display = (b >= 500) ? 'none' : 'block';
            document.getElementById('ref-code-display').innerText = `https://neonelite-casino.vercel.app/?ref=${userData.uid}`;
            document.getElementById('ref-earn').innerText = "Rs. " + (userData.referralEarnings || 0).toFixed(2);
            document.getElementById('ref-count').innerText = userData.totalReferrals || 0;
            
            const today = new Date().toDateString();
            const lastDate = userData.spinData?.date || "";
            let dailyUsed = (lastDate === today) ? userData.spinData.count : 0;
            let available = (dailyUsed < 2) ? 2 - dailyUsed : userData.extraSpins || 0;
            document.getElementById('spins-available').innerText = (dailyUsed < 2) ? `${available} (Daily) + ${userData.extraSpins} (Extra)` : available;

            const home = document.getElementById('view-home');
            if(!userData.isVerified) {
                home.innerHTML = `<div class="modern-card" style="text-align:center; border-color:var(--gold);"><i data-lucide="shield-alert" style="width:50px; height:50px; color:var(--gold); margin-bottom:15px;"></i><h3>ACCOUNT UNVERIFIED</h3><p style="font-size:11px; opacity:0.6; margin-bottom:20px;">Bind your wallet to claim Rs. 177 Bonus.</p><button class="btn btn-gold" onclick="handleClaimBonus()"><i data-lucide="gift"></i> CLAIM BONUS</button></div>`;
            } else {
                home.innerHTML = `
                <div class="carousel-container"><div class="carousel-track" id="dash-track"></div></div>
                
                <h4 class="cat-title">üöÄ CRASH & ARCADE</h4>
                <div class="games-grid">
                    <div class="g-card" onclick="switchTab('crash')"><div class="g-icon" style="padding:0; overflow:hidden;"><img src="https://i.ibb.co/9HBFrrP3/featured-image-2024-11-28-T191534-766.png" style="width:100%; height:100%; object-fit:cover;"></div><div class="g-info"><h5 class="g-title">Neon Crash</h5><div class="g-footer"><span class="play-tag"><i data-lucide="play" style="width:8px;"></i> PLAY</span><span class="live-users"><div class="live-dot"></div> 842</span></div></div></div>
                    <div class="g-card" onclick="switchTab('plinko')"><div class="g-icon" style="padding:0; overflow:hidden;"><img src="https://i.ibb.co/SXpTqMW8/com-jogo-luckyplinko-icon-2023-08-20-09-31-32.png" style="width:100%; height:100%; object-fit:cover;"></div><div class="g-info"><h5 class="g-title">Plinko</h5><div class="g-footer"><span class="play-tag"><i data-lucide="play" style="width:8px;"></i> PLAY</span><span class="live-users"><div class="live-dot"></div> 2.4k</span></div></div></div>
                </div>

                <h4 class="cat-title">üí£ MINES & STRATEGY</h4>
                <div class="games-grid">
                    <div class="g-card" onclick="switchTab('mines')"><div class="g-icon" style="padding:0; overflow:hidden;"><img src="https://i.ibb.co/nsFh25cb/tile-large.jpg" style="width:100%; height:100%; object-fit:cover;"></div><div class="g-info"><h5 class="g-title">Mines</h5><div class="g-footer"><span class="play-tag"><i data-lucide="play" style="width:8px;"></i> PLAY</span><span class="live-users"><div class="live-dot"></div> 1.2k</span></div></div></div>
                    <div class="g-card" onclick="switchTab('bricks')"><div class="g-icon" style="padding:0; overflow:hidden;"><img src="https://i.ibb.co/m5K4KG9D/Tower.jpg" style="width:100%; height:100%; object-fit:cover;"></div><div class="g-info"><h5 class="g-title">Tower</h5><div class="g-footer"><span class="play-tag"><i data-lucide="play" style="width:8px;"></i> PLAY</span><span class="live-users"><div class="live-dot"></div> 590</span></div></div></div>
                </div>

                <h4 class="cat-title">üé∞ SLOTS & CASINO</h4>
                <div class="games-grid">
                    <div class="g-card" onclick="switchTab('slots')"><div class="g-icon" style="padding:0; overflow:hidden;"><img src="https://i.ibb.co/7tWXqwGY/460px-Generic-Image-Slot.jpg" style="width:100%; height:100%; object-fit:cover;"></div><div class="g-info"><h5 class="g-title">Neon Slots</h5><div class="g-footer"><span class="play-tag" style="background:var(--neon-purple); color:#fff;"><i data-lucide="play" style="width:8px;"></i> PLAY</span><span class="live-users"><div class="live-dot"></div> 2.1k</span></div></div></div>
                </div>`;
            }

            // Update Offers View if Claimed
            const offersView = document.getElementById('view-offers');
            if(userData.bonusClaimed) {
                offersView.innerHTML = `<div class="modern-card" style="text-align:center; border-color:var(--emerald);"><div style="background:rgba(16,185,129,0.1); width:60px; height:60px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 15px;"><i data-lucide="check-circle" style="width:30px; height:30px; color:var(--emerald);"></i></div><h2 style="color:var(--emerald); margin-bottom:10px;">BONUS CLAIMED</h2><p style="font-size:12px; opacity:0.8;">You have already received your Rs. 177 signup bonus.</p></div>`;
            } else {
                offersView.innerHTML = `<div class="modern-card" style="text-align:center; background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(0,0,0,0.4)); border-color: var(--gold);"><div style="background:var(--gold); width:60px; height:60px; border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 15px; box-shadow: 0 0 20px var(--gold-glow);"><i data-lucide="gift" style="width:30px; height:30px; color:#000;"></i></div><h2 style="color:var(--gold); font-weight:900; margin-bottom:5px;">SIGNUP BONUS</h2><h1 style="color:#fff; font-size:36px; font-weight:900; margin:10px 0;">Rs. 177.00</h1><p style="font-size:12px; opacity:0.8; margin-bottom:20px;">Bind your Real Account (EasyPaisa/JazzCash) to claim this bonus instantly! No WhatsApp required.</p><button class="btn btn-gold" onclick="handleClaimBonus()">CLAIM NOW</button></div>`;
            }

            lucide.createIcons();
        }

        // --- IDENTITY & BONUS LOGIC ---
        function handleClaimBonus() {
            if(userData.bonusClaimed) return toast("Bonus already claimed!", "error");
            if(!userData.walletPasscode) {
                document.getElementById('setup-passcode-modal').style.display = 'flex';
            } else if(!userData.paymentMethod) {
                document.getElementById('bind-account-modal').style.display = 'flex';
            } else {
                toast("Already Verified", "success");
            }
        }

        async function savePasscode() {
            const pin = document.getElementById('new-passcode').value;
            if(!/^\d{8}$/.test(pin)) return toast("Passcode must be exactly 8 digits", "error");
            await db.collection('users').doc(userData.uid).update({ walletPasscode: pin });
            document.getElementById('setup-passcode-modal').style.display = 'none';
            toast("Passcode Set!", "success");
            if(!userData.paymentMethod) document.getElementById('bind-account-modal').style.display = 'flex';
        }

        function toggleBindBankInput() {
            const val = document.getElementById('bind-bank').value;
            document.getElementById('bind-other-bank-div').style.display = (val === 'Other') ? 'block' : 'none';
        }

        async function bindAccount() {
            let bank = document.getElementById('bind-bank').value;
            if(bank === 'Other') bank = document.getElementById('bind-other-bank').value;
            const name = document.getElementById('bind-name').value.trim();
            const number = document.getElementById('bind-number').value.trim();
            const cnic = document.getElementById('bind-cnic').value.trim();

            if(!bank || !name || !number || !cnic) return toast("Fill all fields", "error");

            const q1 = await db.collection('users').where('paymentMethod.number', '==', number).get();
            const q2 = await db.collection('users').where('paymentMethod.cnic', '==', cnic).get();
            
            if(!q1.empty || !q2.empty) return toast("Account details already bound to another user!", "error");

            await db.collection('users').doc(userData.uid).update({
                paymentMethod: { bank, name, number, cnic },
                isVerified: true,
                bonusClaimed: true,
                balance: firebase.firestore.FieldValue.increment(177)
            });

            document.getElementById('bind-account-modal').style.display = 'none';
            sfx('win'); confetti();
            toast("Bonus Claimed! Account Verified.", "success");
        }

        // --- MODAL & TXN LOGIC ---
        function openModal(mode) {
            document.getElementById('modal-title').innerText = mode.toUpperCase();
            if(mode === 'Deposit') {
                document.getElementById('deposit-view').style.display = 'block';
                document.getElementById('withdraw-view').style.display = 'none';
            } else {
                if(!userData.walletPasscode || !userData.paymentMethod) {
                    toast("Please Bind Account first!", "error");
                    return handleClaimBonus();
                }
                document.getElementById('deposit-view').style.display = 'none';
                document.getElementById('withdraw-view').style.display = 'block';
                document.getElementById('wd-bank').innerText = "Bank: " + userData.paymentMethod.bank;
                document.getElementById('wd-number').innerText = "Account: " + userData.paymentMethod.number;
                document.getElementById('wd-name').innerText = "Name: " + userData.paymentMethod.name;
            }
            document.getElementById('txn-modal').style.display = 'flex';
        }
        function closeModal() { document.getElementById('txn-modal').style.display = 'none'; }
        
        function openSupport() { document.getElementById('support-modal').style.display = 'flex'; }
        function closeSupport() { document.getElementById('support-modal').style.display = 'none'; }
        function toggleBankInput() { document.getElementById('other-bank-div').style.display = (document.getElementById('txn-bank').value === 'Other') ? 'block' : 'none'; }

        async function submitDeposit() {
            const amt = parseFloat(document.getElementById('txn-amount').value);
            const name = document.getElementById('txn-name').value;
            let bank = document.getElementById('txn-bank').value;
            if (bank === 'Other') bank = document.getElementById('txn-other-bank').value;
            const num = document.getElementById('txn-number').value;

            if(!amt || amt <= 0 || !name || !num || !bank) return toast("Invalid Details", "error");

            await db.collection('requests').add({ uid: userData.uid, email: userData.email, amount: amt, name, bank, number: num, type: 'Deposit', status: 'pending', timestamp: firebase.firestore.FieldValue.serverTimestamp() });
            const msg = `üé∞ *DEPOSIT REQUEST*\nAmount: ${amt}\nBank: ${bank}\nAccount: ${num}\nName: ${name}\nUser: ${userData.email}`;
            window.open(`https://wa.me/${WHATSAPP_SUPPORT}?text=${encodeURIComponent(msg)}`, '_blank');
            closeModal(); toast("Deposit Request Submitted", "success");
        }

        async function submitWithdraw() {
            const amt = parseFloat(document.getElementById('wd-amount').value);
            const pin = document.getElementById('wd-passcode').value;

            if(!amt || amt <= 0) return toast("Invalid Amount", "error");
            if(amt > userData.balance) return toast("Insufficient Balance", "error");
            if(pin !== userData.walletPasscode) return toast("Invalid Passcode", "error");

            await db.collection('users').doc(userData.uid).update({ balance: firebase.firestore.FieldValue.increment(-amt) });
            await db.collection('requests').add({ 
                uid: userData.uid, email: userData.email, amount: amt, 
                name: userData.paymentMethod.name, bank: userData.paymentMethod.bank, number: userData.paymentMethod.number,
                cnic: userData.paymentMethod.cnic,
                type: 'Withdraw', status: 'pending', timestamp: firebase.firestore.FieldValue.serverTimestamp() 
            });
            
            const msg = `üé∞ *WITHDRAW REQUEST*\nAmount: ${amt}\nBank: ${userData.paymentMethod.bank}\nAccount: ${userData.paymentMethod.number}\nName: ${userData.paymentMethod.name}\nUser: ${userData.email}`;
            window.open(`https://wa.me/${WHATSAPP_SUPPORT}?text=${encodeURIComponent(msg)}`, '_blank');
            closeModal(); toast("Withdraw Request Submitted", "success");
        }

        async function sync(amount) { await db.collection('users').doc(userData.uid).update({ balance: firebase.firestore.FieldValue.increment(amount) }); }
        async function refreshBal() { gsap.to("#ref-btn", { rotation: "+=360", duration: 0.6 }); toast("Balance Synced", "success"); }

        function switchTab(t) {
            if(t!=='home' && t!=='profile' && t!=='settings' && t!=='refer' && t!=='spin' && t!=='offers' && !userData.isVerified) return toast("Bind Wallet First!", "error");
            const body = document.body;
            if (t === 'crash' || t === 'mines' || t === 'bricks' || t === 'plinko' || t === 'slots') { body.classList.add('game-mode'); } 
            else { body.classList.remove('game-mode'); stopGameSounds(); stopCrashGame(); }
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-' + t).classList.add('active');
            let navId = 'nav-home';
            if(t==='profile') navId='nav-profile'; else if(t==='settings') navId='nav-settings'; else if(t==='refer') navId='nav-refer'; else if(t==='spin') navId='nav-spin'; else if(t==='offers') navId='nav-offers';
            if(['home','profile','settings','refer', 'spin', 'offers'].includes(t)){ document.getElementById(navId).classList.add('active'); }
            resetMines(); resetBricks();
            if(t==='crash' && !window.crashGameRunning) initCrashGame();
            if(t==='plinko') initPlinko();
            lucide.createIcons();
        }

        // --- GAME LOGIC ---
        function copyReferral() {
            const link = `https://neonelite-casino.vercel.app/?ref=${userData.uid}`;
            if (navigator.clipboard && navigator.clipboard.writeText) navigator.clipboard.writeText(link).then(() => toast("Link Copied!")).catch(() => fallbackCopy(link));
            else fallbackCopy(link);
        }
        function fallbackCopy(text) {
            const textArea = document.createElement("textarea"); textArea.value = text;
            document.body.appendChild(textArea); textArea.select();
            try { document.execCommand('copy'); toast("Link Copied!"); } catch (err) { toast("Copy Failed", "error"); }
            document.body.removeChild(textArea);
        }

        const segments = [{l:"+5",t:'win',v:5},{l:"-5",t:'loss',v:-5},{l:"+3",t:'win',v:3},{l:"-3",t:'loss',v:-3},{l:"+1",t:'win',v:1},{l:"-1",t:'loss',v:-1},{l:"Spin",t:'free',v:0},{l:"üò≠",t:'nothing',v:0}];
        let isSpinning=false;
        async function spinWheel(){
            if(isSpinning)return;
            const today=new Date().toDateString();
            const lastDate=userData.spinData?.date||"";
            let dailyUsed=(lastDate===today)?userData.spinData.count:0;
            let extra=userData.extraSpins||0;
            let isDaily=(dailyUsed<2);
            if(!isDaily && extra<=0){toast("No spins left! Refer friends.","error");switchTab('refer');return;}
            isSpinning=true;document.getElementById('btn-spin').disabled=true;document.getElementById('spin-msg').innerText="Spinning...";
            const randIndex=Math.floor(Math.random()*8);const segment=segments[randIndex];
            const endRot=1800+(360-((randIndex*45)+22.5));
            const wheel=document.getElementById('wheel-outer');wheel.style.transform=`rotate(${endRot}deg)`;
            const tick=setInterval(()=>{sfx('click');},300);
            setTimeout(async()=>{
                clearInterval(tick);isSpinning=false;document.getElementById('btn-spin').disabled=false;
                if(segment.t==='win'){await sync(segment.v);toast(`Won ${segment.v} PKR!`,'success');sfx('win');confetti();}
                else if(segment.t==='loss'){await sync(segment.v);toast(`Lost ${Math.abs(segment.v)} PKR`,'error');sfx('lose');}
                else if(segment.t==='free'){toast("Free Spin!",'success');await db.collection('users').doc(userData.uid).update({extraSpins:firebase.firestore.FieldValue.increment(1)});}
                else {toast("Nothing",'error');sfx('lose');}
                document.getElementById('spin-msg').innerText=segment.l==="Spin"?"FREE SPIN!":(segment.l==="üò≠"?"NOTHING":`${segment.l} PKR`);
                if(segment.t!=='free'){
                    if(isDaily)await db.collection('users').doc(userData.uid).update({spinData:{count:dailyUsed+1,date:today}});
                    else await db.collection('users').doc(userData.uid).update({extraSpins:firebase.firestore.FieldValue.increment(-1)});
                }
                setTimeout(()=>{wheel.style.transition='none';wheel.style.transform=`rotate(${360-((randIndex*45)+22.5)}deg)`;setTimeout(()=>wheel.style.transition='transform 4s cubic-bezier(0.1,0.9,0.2,1)',50);},1000);
            },4000);
        }

        let crashReqId,crashCtx,crashCanvas,crashState='WAITING',crashMult=1.00,crashTime=0,crashBet=0,crashAuto=0,crashMyBetActive=false,crashNextBet=false,crashStars=[],crashHistory=[];window.crashGameRunning=false;
        function stopCrashGame(){window.crashGameRunning=false;cancelAnimationFrame(crashReqId);}
        function initCrashGame(){window.crashGameRunning=true;crashCanvas=document.getElementById('crash-canvas');crashCtx=crashCanvas.getContext('2d');resizeCrash();window.addEventListener('resize',resizeCrash);crashStars=Array.from({length:50},()=>({x:Math.random()*crashCanvas.width,y:Math.random()*crashCanvas.height,s:Math.random()*2}));startCountdown();loopCrash();}
        function resizeCrash(){const r=document.getElementById('crash-stage').getBoundingClientRect();crashCanvas.width=r.width;crashCanvas.height=r.height;}
        function updateCrashHistory(m){crashHistory.unshift(m);if(crashHistory.length>20)crashHistory.pop();const b=document.getElementById('crash-history');b.innerHTML='';crashHistory.forEach(h=>{const d=document.createElement('div');d.className=`h-badge ${h>=10?'jackpot':h>=2?'win':'lose'}`;d.innerText=h.toFixed(2)+'x';b.appendChild(d);});}
        function loopCrash(){if(!window.crashGameRunning)return;crashCtx.fillStyle='#050505';crashCtx.fillRect(0,0,crashCanvas.width,crashCanvas.height);crashCtx.strokeStyle='rgba(0,243,255,0.1)';crashCtx.lineWidth=1;crashCtx.beginPath();const t=(Date.now()/50)%40;for(let i=0;i<crashCanvas.width;i+=40){crashCtx.moveTo(i-t,0);crashCtx.lineTo(i-t,crashCanvas.height);}for(let i=0;i<crashCanvas.height;i+=40){crashCtx.moveTo(0,i);crashCtx.lineTo(crashCanvas.width,i);}crashCtx.stroke();crashCtx.fillStyle='#fff';crashStars.forEach(s=>{s.x-=(0.5+(crashState==='FLYING'?crashMult*1.5:0));if(s.x<0)s.x=crashCanvas.width;crashCtx.globalAlpha=Math.random();crashCtx.beginPath();crashCtx.arc(s.x,s.y,s.s,0,Math.PI*2);crashCtx.fill();});crashCtx.globalAlpha=1;if(crashState==='FLYING'){crashTime+=0.016;crashMult=1.00+(Math.pow(1.025,crashTime*10)-1);document.getElementById('crash-value').innerText=crashMult.toFixed(2)+'x';document.getElementById('crash-value').style.color='#fff';if(crashMyBetActive&&crashAuto>1&&crashMult>=crashAuto)cashoutCrash();let p=0.003+(crashTime*0.0005);if(Math.random()<p)doCrash();}const w=crashCanvas.width;const h=crashCanvas.height;let pg=0;if(crashState==='FLYING'||crashState==='CRASHED')pg=Math.min(1,(crashMult-1)/5);const jx=50+(pg*(w-100));const jy=h-50-(pg*(h-100));if(crashState!=='WAITING'){crashCtx.beginPath();crashCtx.moveTo(0,h);crashCtx.quadraticCurveTo(jx/2,h,jx,jy);crashCtx.strokeStyle='#00f3ff';crashCtx.lineWidth=3;crashCtx.stroke();const g=crashCtx.createLinearGradient(0,0,0,h);g.addColorStop(0,'rgba(0,243,255,0.2)');g.addColorStop(1,'rgba(0,243,255,0)');crashCtx.lineTo(jx,h);crashCtx.lineTo(0,h);crashCtx.fillStyle=g;crashCtx.fill();}if(crashState!=='CRASHED'){crashCtx.save();crashCtx.translate(jx,jy);crashCtx.rotate(-0.5);crashCtx.font="30px Arial";crashCtx.textAlign="center";crashCtx.textBaseline="middle";crashCtx.fillText("üöÄ",0,0);if(crashState==='FLYING'){crashCtx.rotate(0.5);crashCtx.rotate(Date.now()/200);crashCtx.strokeStyle='rgba(255,255,255,0.5)';crashCtx.lineWidth=1;crashCtx.beginPath();crashCtx.arc(0,0,25,0,Math.PI*2);crashCtx.stroke();}crashCtx.restore();}crashReqId=requestAnimationFrame(loopCrash);}
        function handleCrashAction(){const btn=document.getElementById('btn-crash-action');if(crashState==='WAITING'){if(crashNextBet)return;const b=parseFloat(document.getElementById('crash-bet').value);const a=parseFloat(document.getElementById('crash-auto').value);if(b>userData.balance||b<=0)return toast("Low Balance","error");crashBet=b;crashAuto=a||0;crashNextBet=true;sync(-b);btn.innerHTML=`<i data-lucide="check"></i> BET PLACED`;btn.className="btn btn-gold";}else if(crashState==='FLYING'&&crashMyBetActive){cashoutCrash();}}
        function startCountdown(){crashState='WAITING';crashMyBetActive=false;const btn=document.getElementById('btn-crash-action');if(crashNextBet){crashMyBetActive=true;crashNextBet=false;btn.innerHTML=`<i data-lucide="check"></i> BET ACCEPTED`;btn.className="btn btn-gold";}else{btn.className="btn btn-crash";btn.innerHTML=`<i data-lucide="rocket"></i> PLACE BET`;btn.disabled=false;}document.getElementById('crash-msg').innerText="NEXT ROUND IN";document.getElementById('crash-value').style.color='var(--gold)';document.getElementById('crash-loader').style.display='block';let tl=5.0;const tm=setInterval(()=>{if(!window.crashGameRunning){clearInterval(tm);return;}tl-=0.1;document.getElementById('crash-value').innerText=Math.abs(tl).toFixed(1)+'s';document.getElementById('crash-fill').style.width=((5.0-tl)/5.0)*100+'%';if(tl<=0){clearInterval(tm);document.getElementById('crash-loader').style.display='none';beginFlight();}},100);}
        function beginFlight(){const btn=document.getElementById('btn-crash-action');if(btn.innerText.includes("PLACE BET")){btn.disabled=true;btn.innerHTML="WAITING FOR NEXT ROUND";}else{btn.innerHTML=`<i data-lucide="download"></i> CASH OUT`;btn.className="btn btn-gold";crashMyBetActive=true;}crashState='FLYING';crashMult=1.00;crashTime=0;document.getElementById('crash-msg').innerText="CURRENT FLIGHT";sfx('engine_start');}
        function cashoutCrash(){if(!crashMyBetActive)return;crashMyBetActive=false;const win=crashBet*crashMult;sync(win);sfx('win');toast(`+${win.toFixed(2)} PKR`,'success');const btn=document.getElementById('btn-crash-action');btn.innerHTML=`<i data-lucide="check"></i> WON ${win.toFixed(0)}`;btn.className="btn btn-primary";btn.disabled=true;}
        function doCrash(){crashState='CRASHED';sfx('engine_stop');sfx('crash_fly');updateCrashHistory(crashMult);document.getElementById('crash-value').style.color='var(--ruby)';document.getElementById('crash-msg').innerText="FLEW AWAY";if(crashMyBetActive){crashMyBetActive=false;const btn=document.getElementById('btn-crash-action');btn.className="btn btn-crash";btn.innerHTML="CRASHED";}setTimeout(()=>{if(!window.crashGameRunning)return;crashNextBet=false;startCountdown();},2000);}

        let mActive=false,mPos=[],mRev=0,mBet=0;
        function startMines(){const b=parseFloat(document.getElementById('mine-bet').value);const c=parseInt(document.getElementById('mine-count').value);if(b>userData.balance||b<=0)return toast("Low Balance","error");mBet=b;mRev=0;mActive=true;sync(-b);mPos=Array(25).fill(false);let p=0;while(p<c){let r=Math.floor(Math.random()*25);if(!mPos[r]){mPos[r]=true;p++;}}const g=document.getElementById('mines-grid');g.innerHTML='';for(let i=0;i<25;i++){const t=document.createElement('div');t.className='tile';t.onclick=()=>{if(!mActive||t.innerText)return;if(mPos[i]){t.innerText='üí£';t.style.background='var(--ruby)';mActive=false;document.getElementById('btn-m-cash').style.display='none';sfx('lose');setTimeout(resetMines,1500);}else{t.innerText='üíé';t.style.color='var(--emerald)';mRev++;sfx('gem');const m=(25/(25-mRev-c))*0.85;document.getElementById('mine-status').innerText=`${m.toFixed(2)}x Profit`;}};g.appendChild(t);}document.getElementById('btn-m-start').style.display='none';document.getElementById('btn-m-cash').style.display='flex';}
        function cashoutMines(){if(!mActive)return;const c=parseInt(document.getElementById('mine-count').value);const m=(25/(25-mRev-c))*0.85;sync(mBet*m);confetti();sfx('win');resetMines();}
        function resetMines(){mActive=false;document.getElementById('btn-m-start').style.display='flex';document.getElementById('btn-m-cash').style.display='none';document.getElementById('mine-status').innerText='';}

        let bActive=false,bRow=0,bBombs=[],bBet=0;const bMults=[1.1,1.3,1.6,2.0,2.8,4.0,6.0,10.0,20.0,40.0];
        function startBricks(){const b=parseFloat(document.getElementById('brick-bet').value);if(b>userData.balance||b<=0)return toast("Low Balance","error");bBet=b;sync(-b);bActive=true;bRow=0;bBombs=[];for(let i=0;i<10;i++){if(i<5)bBombs.push([Math.floor(Math.random()*3)]);else{let bm=[];while(bm.length<2){let r=Math.floor(Math.random()*3);if(!bm.includes(r))bm.push(r);}bBombs.push(bm);}}document.getElementById('btn-b-start').style.display='none';renderBricks();}
        function renderBricks(){const c=document.getElementById('tower-container');c.innerHTML='<div id="ball"></div>';for(let i=0;i<10;i++){const r=document.createElement('div');r.className=`t-row ${i===bRow?'':'locked'}`;for(let j=0;j<3;j++){const br=document.createElement('div');br.className='brick';br.onclick=()=>{if(bActive&&i===bRow)hitBrick(i,j,br);};r.appendChild(br);}c.appendChild(r);}document.getElementById('brick-status').innerText=`Row ${bRow+1} Multiplier: ${bMults[bRow]}x`;}
        function hitBrick(r,i,e){const bl=document.getElementById('ball');const rt=e.getBoundingClientRect();const cr=document.getElementById('tower-container').getBoundingClientRect();gsap.to(bl,{left:rt.left-cr.left+(rt.width/2),bottom:cr.bottom-rt.top-(rt.height/2),duration:0.4,onComplete:()=>{const cb=bBombs[r];if(cb.includes(i)){e.innerText='üí£';bActive=false;document.getElementById('btn-b-cash').style.display='none';sfx('lose');setTimeout(resetBricks,1500);}else{e.innerText='üíé';bRow++;sfx('gem');document.getElementById('btn-b-cash').style.display='flex';if(bRow===10){sync((bBet*40)+100);confetti();sfx('win');toast("JACKPOT +100!","success");resetBricks();}else{gsap.to(bl,{bottom:"-15px",left:"50%",duration:0.3});renderBricks();}}}});}
        function cashoutBricks(){if(!bActive)return;sync(bBet*bMults[bRow-1]);confetti();sfx('win');resetBricks();}
        function resetBricks(){bActive=false;document.getElementById('btn-b-start').style.display='flex';document.getElementById('btn-b-cash').style.display='none';gsap.to("#ball",{bottom:"-15px",left:"50%"});}

        // --- PLINKO LOGIC ---
        const pMs=[4, 3, 2, 0.8, 0.5, 0.2, 1, 0.2, 0.5, 0.8, 2, 3, 4];
        let pC,pCtx,pRq,pBs=[],pPs=[];const pRs=12;
        
        function initPlinko(){
            pC=document.getElementById('plinko-canvas');
            const r=document.getElementById('plinko-stage').getBoundingClientRect();
            pC.width=r.width;
            pC.height=r.height;
            pCtx=pC.getContext('2d');
            const b=document.getElementById('plinko-buckets');
            b.innerHTML='';
            pMs.forEach((m)=>{
                const e=document.createElement('div');
                e.className='p-bucket';
                e.innerText=m+'x';
                if(m>=2) e.style.background='var(--gold)';
                else if(m<1) e.style.background='var(--ruby)';
                else e.style.background='var(--text-muted)';
                b.appendChild(e);
            });
            genPegs();
            if(pRq)cancelAnimationFrame(pRq);
            loopPlinko();
        }

        function genPegs(){
            pPs=[];
            const gy=pC.height/(pRs+2);
            const gx=pC.width/(pRs+3);
            for(let r=0;r<pRs;r++){
                const pr=r+3;
                const rw=(pr-1)*gx;
                const sx=(pC.width-rw)/2;
                for(let c=0;c<pr;c++){
                    pPs.push({x:sx+(c*gx),y:(gy*(r+1))+20,r:3});
                }
            }
        }

        function dropPlinkoBall(){
            const b=parseFloat(document.getElementById('plinko-bet').value);
            if(b>userData.balance||b<=0)return toast("Invalid Bet","error");
            sync(-b);
            pBs.push({x:pC.width/2+(Math.random()*1.5-0.75),y:10,vx:(Math.random()-0.5)*0.3,vy:0,r:5,bet:b,active:true});
        }

        function loopPlinko(){
            pCtx.clearRect(0,0,pC.width,pC.height);
            pCtx.fillStyle='#fff';
            pPs.forEach(p=>{pCtx.beginPath();pCtx.arc(p.x,p.y,p.r,0,Math.PI*2);pCtx.fill();});
            pCtx.fillStyle='var(--neon-pink)';
            pBs.forEach(b=>{
                if(!b.active)return;
                b.vy+=0.25; b.y+=b.vy; b.vx*=0.98; b.x+=b.vx;
                pPs.forEach(p=>{
                    const dx=b.x-p.x; const dy=b.y-p.y; const d=Math.sqrt(dx*dx+dy*dy);
                    if(d<b.r+p.r){ b.vy*=-0.4; b.vx += (dx/d) * 0.8 + (Math.random() * 0.4 - 0.2); b.y=p.y+(dy/d)*(b.r+p.r+1); sfx('click'); }
                });
                if(b.x<0||b.x>pC.width) b.vx*=-0.8;
                pCtx.beginPath();pCtx.arc(b.x,b.y,b.r,0,Math.PI*2);pCtx.fill();
                if(b.y>pC.height-20){ b.active=false; resPWin(b); }
            });
            pBs=pBs.filter(b=>b.active);
            pRq=requestAnimationFrame(loopPlinko);
        }

        function resPWin(b){
            const bw=pC.width/13; let i=Math.floor(b.x/bw); if(i<0)i=0; if(i>12)i=12;
            const m=pMs[i]; const w=b.bet*m;
            if(w>0){ sync(w); if(m<1) toast(`Plinko: ${m}x | ${w.toFixed(0)}`,'error'); else toast(`Plinko: ${m}x | +${w.toFixed(0)}`,'success'); if(m>=2){ sfx('win'); confetti(); }}
        }

        // --- NEW REALISTIC SLOTS LOGIC ---
        let slotActive = false;
        const slotSymbols = ['üçí', 'üçã', 'üçá', 'üîî', '7Ô∏è‚É£', 'üíé']; 
        
        // Helper to get random symbol with weights
        const getWeightedSymbol = () => {
            const r = Math.random() * 100;
            if(r < 40) return 'üçí'; // 40%
            if(r < 70) return 'üçã'; // 30%
            if(r < 85) return 'üçá'; // 15%
            if(r < 95) return 'üîî'; // 10%
            if(r < 99) return '7Ô∏è‚É£'; // 4%
            return 'üíé';          // 1%
        };

        function initSlots() {
            // Fill strips with random symbols initially
            for(let i=0; i<3; i++) {
                const strip = document.getElementById(`strip-${i}`);
                let html = '';
                // Create a tall strip of symbols (e.g. 30 symbols)
                for(let j=0; j<30; j++) {
                    const sym = slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
                    html += `<div class="reel-symbol">${sym}</div>`;
                }
                strip.innerHTML = html;
                // Initial offset to show a random middle symbol (Index 1 starts at top)
                strip.style.transform = `translateY(0px)`;
            }
        }

        async function spinSlots() {
            if(slotActive) return;
            const betInput = document.getElementById('slots-bet');
            const b = parseFloat(betInput.value);
            
            if(!betInput.value || b <= 0 || isNaN(b)) return toast("Please enter a valid bet amount!", "error");
            if(b > userData.balance) return toast("Insufficient Balance", "error");

            slotActive = true;
            sync(-b);
            
            // CHANGED SOUND TO GENERIC SPIN (NOT CRASH ENGINE)
            sfx('slot_spin');

            const results = [getWeightedSymbol(), getWeightedSymbol(), getWeightedSymbol()];
            const reelHeight = 120; // Height of one symbol container
            
            // Spin each reel
            const spinPromises = results.map((resSymbol, index) => {
                return new Promise(resolve => {
                    const strip = document.getElementById(`strip-${index}`);
                    
                    strip.classList.add('reel-blur');
                    
                    // Re-generate strip content to ensure our result is at a specific "end" point
                    let content = '';
                    // Add 20 random junk symbols for "speed"
                    for(let k=0; k<20; k++) content += `<div class="reel-symbol">${slotSymbols[Math.floor(Math.random()*slotSymbols.length)]}</div>`;
                    
                    // Add result sequence
                    const junk1 = slotSymbols[Math.floor(Math.random()*slotSymbols.length)];
                    const junk2 = slotSymbols[Math.floor(Math.random()*slotSymbols.length)];
                    
                    content += `<div class="reel-symbol">${junk1}</div>`; // Row 1 (Visible)
                    content += `<div class="reel-symbol">${resSymbol}</div>`; // Row 2 (Middle - Winning Line)
                    content += `<div class="reel-symbol">${junk2}</div>`; // Row 3 (Visible)
                    
                    strip.innerHTML = content;
                    
                    // Reset position instantly
                    strip.style.transition = 'none';
                    strip.style.transform = `translateY(0px)`;

                    // Trigger reflow
                    strip.offsetHeight; 

                    // Animate to position
                    const targetY = -(20 * 120); 

                    // Add delay per reel for cascade effect
                    setTimeout(() => {
                        strip.style.transition = 'transform 2.5s cubic-bezier(0.25, 1, 0.5, 1)'; 
                        strip.style.transform = `translateY(${targetY}px)`;
                        
                        // When animation finishes
                        setTimeout(() => {
                            strip.classList.remove('reel-blur');
                            sfx('clack'); 
                            resolve();
                        }, 2500);
                    }, index * 300);
                });
            });

            await Promise.all(spinPromises);

            // Calculate Win (UPDATED Multipliers)
            let win = 0;
            if(results[0] === results[1] && results[1] === results[2]) {
                const s = results[0];
                if(s === 'üíé') win = b * 25;       // Now 25x
                else if(s === '7Ô∏è‚É£') win = b * 15;   // Now 15x
                else if(s === 'üîî') win = b * 5;    // Same 5x
                else if(s === 'üçá') win = b * 2.5;  // Same 2.5x
                else if(s === 'üçã') win = b * 1.5;  // Same 1.5x
                else if(s === 'üçí') win = b * 1;    // Same 1x
            }

            if(win > 0) {
                sync(win);
                sfx('win');
                confetti();
                toast(`Jackpot! Won ${win}`, "success");
            } else {
                sfx('lose');
            }
            slotActive = false;
        }

        lucide.createIcons();
    </script>
</body>
</html>
